<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog" 
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet author="Colter McQuay" id="0">
        <sql>
            CREATE SCHEMA IF NOT EXISTS ${PGRST_DB_SCHEMA};
        </sql>
        <rollback>
            <sql>
                DROP SCHEMA IF EXISTS ${PGRST_DB_SCHEMA};
            </sql>
        </rollback>
    </changeSet>

    <changeSet author="Colter McQuay" id="1">
        <sql>
            CREATE ROLE "${PGRST_DB_ANON_ROLE}" WITH NOLOGIN;            
        </sql>
        <rollback>
            <sql>
                DROP ROLE "${PGRST_DB_ANON_ROLE}";
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet author="Colter McQuay" id="2">
        <sql>
            GRANT "${PGRST_DB_ANON_ROLE}" TO "${POSTGRES_USER}";
        </sql>
        <rollback>
            <sql>
                REVOKE "${PGRST_DB_ANON_ROLE}" FROM "${POSTGRES_USER}";
            </sql>
        </rollback>
    </changeSet>

    <changeSet author="Colter McQuay" id="3">
        <sql>
            GRANT USAGE ON SCHEMA ${PGRST_DB_SCHEMA} TO "${PGRST_DB_ANON_ROLE}";
        </sql>
        <rollback>
            <sql>
                REVOKE USAGE ON SCHEMA ${PGRST_DB_SCHEMA} FROM "${PGRST_DB_ANON_ROLE}";
            </sql>
        </rollback>
    </changeSet>
</databaseChangeLog>
